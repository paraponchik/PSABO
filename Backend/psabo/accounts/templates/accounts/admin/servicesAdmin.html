<!DOCTYPE html>
<html lang="en">
<head>
  {% load static %}
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏</title>
  <link href="{% static 'css/admin-services.css' %}" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .tile {
      background-color: #e8f5e9;
      color: #388e3c;
      border-radius: 8px;
      text-align: center;
      padding: 20px;
      margin: 10px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .tile:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .add-tile {
      background-color: #e0f7fa;
      color: #00796b;
      border: 2px dashed #00796b;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
    }

    .selected-service {
      background-color: #c8e6c9;
      border: 2px solid #388e3c;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="profile">
      <img src="../../../static/images/ava.jpg" alt="Profile">
      <h5>{{ user.full_name }}</h5>
      <p>{{ user.email }}</p>
    </div>
    <a href="{% url 'admin_services' %}" class="nav-link active">üõ† –°–µ—Ä–≤–∏—Å—ã</a>
    <a href="{% url 'admin_calendar' %}" class="nav-link">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
    <a href="{% url 'admin_access' %}" class="nav-link">üîë –î–æ—Å—Ç—É–ø—ã</a>
    <a href="{% url 'admin_accounting' %}" class="nav-link">üìä –£—á–µ—Ç</a>
    <a href="{% url 'admin_users' %}" class="nav-link">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
    <a href="{% url 'admin_problems' %}" class="nav-link">üö´ –ü—Ä–æ–±–ª–µ–º—ã</a>
    <a href="{% url 'admin_dashboard' %}" class="nav-link">üìà –î–∏–∞–≥—Ä–∞–º–º—ã</a>
    <div class="logout">
      <form method="POST" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit" class="logout-btn" title="Logout">‚èª</button>
      </form>
    </div>
  </div>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="container-fluid">
      <h3 class="page-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏</h3>
    </div>
    <hr class="section-divider">
  </nav>

  <!-- Content -->
  <div class="content">
    <table class="table table-bordered table-hover">
      <thead>
        <tr>
          <th>#</th>
          <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
          <th>–°—Å—ã–ª–∫–∞</th>
          <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
        </tr>
      </thead>
      <tbody id="serviceTable">
        {% for service in services %}
        <tr data-service-id="{{ service.id }}">
          <td>{{ forloop.counter }}</td>
          <td class="service-name">{{ service.name }}</td>
          <td><a href="{{ service.url }}" class="service-url" target="_blank">{{ service.url }}</a></td>
          <td>
            <button class="btn btn-warning btn-sm" onclick="editService('{{ service.id }}')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn btn-danger btn-sm" onclick="deleteService('{{ service.id }}')">–£–¥–∞–ª–∏—Ç—å</button>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="text-center">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addServiceModal">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å</button>
  </div>

  <!-- Add/Edit Modal -->
  <div class="modal fade" id="addServiceModal" tabindex="-1" aria-labelledby="addServiceModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addServiceModalLabel">–î–æ–±–∞–≤–∏—Ç—å/–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="serviceForm" method="POST">
            {% csrf_token %}
            <input type="hidden" id="serviceId" name="service_id">
            <div class="mb-3">
              <label for="serviceName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
              <input type="text" class="form-control" id="serviceName" name="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞" required>
            </div>
            <div class="mb-3">
              <label for="serviceLink" class="form-label">–°—Å—ã–ª–∫–∞</label>
              <input type="url" class="form-control" id="serviceLink" name="url" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É —Å–µ—Ä–≤–∏—Å–∞" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn btn-primary" form="serviceForm">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function editService(serviceId) {
      const row = document.querySelector(`[data-service-id="${serviceId}"]`);
      const serviceName = row.querySelector('.service-name').textContent;
      const serviceUrl = row.querySelector('.service-url').getAttribute('href');

      document.getElementById('serviceId').value = serviceId;
      document.getElementById('serviceName').value = serviceName;
      document.getElementById('serviceLink').value = serviceUrl;

      const modal = new bootstrap.Modal(document.getElementById('addServiceModal'));
      modal.show();
    }

    function deleteService(serviceId) {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å?')) {
        console.log('–£–¥–∞–ª–∏—Ç—å —Å–µ—Ä–≤–∏—Å —Å ID:', serviceId);
        // –õ–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ AJAX –∏–ª–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
      }
    }
  </script>
</body>
</html>
