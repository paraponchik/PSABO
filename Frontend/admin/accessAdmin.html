<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Access Management</title>
    <link href="../css/admin-services.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="sidebar">
        <div class="profile">
            <img src="https://via.placeholder.com/80" alt="Profile">
            <h5>Admin</h5>
            <p>admin@example.com</p>
        </div>
        <a href="./servicesAdmin.html" class="nav-link">üõ† –°–µ—Ä–≤–∏—Å—ã</a>
        <a href="./calendarAdmin.html" class="nav-link">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
        <a href="./accessAdmin.html" class="nav-link active">üîë –î–æ—Å—Ç—É–ø—ã</a>
        <a href="./accountingAdmin.html" class="nav-link">üìä –£—á–µ—Ç</a>
        <a href="./usersAdmin.html" class="nav-link">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
        <a href="./problemsAdmin.html" class="nav-link">üö´ –ü—Ä–æ–±–ª–µ–º—ã</a>
        <a href="./dashboardAdmin.html" class="nav-link">üìà –î–∏–∞–≥—Ä–∞–º–º—ã</a>
    </div>

    <nav class="navbar">
        <div class="container-fluid">
            <h3 class="page-title">Access Management</h3>
            <div class="d-flex">
                <input id="searchInput" class="form-control me-2" type="search" placeholder="Search..." aria-label="Search">
                <button class="btn btn-outline-success" onclick="filterRequests()">Search</button>
            </div>
        </div>
        <hr class="section-divider">
    </nav>

    <div class="content">
        <div class="table-container">
            <h3 class="mb-4">User Access Requests</h3>
            <table class="table table-bordered">
                <thead class="table-success">
                    <tr>
                        <th>#</th>
                        <th>User</th>
                        <th>Department</th>
                        <th>Service</th>
                        <th>Submission Date</th>
                        <th>Access Level</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="accessTable">
                    <!-- Requests will populate here dynamically -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const accessTable = document.getElementById('accessTable');
        const searchInput = document.getElementById('searchInput');

        let accessRequests = JSON.parse(localStorage.getItem('accessRequests')) || [];

        function loadRequests(filteredRequests = null) {
            const requestsToDisplay = filteredRequests || accessRequests;
            accessTable.innerHTML = requestsToDisplay.map((request, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${request.user || 'N/A'}</td>
                    <td>${request.department || 'N/A'}</td>
                    <td>${request.service}</td>
                    <td>${request.date}</td>
                    <td>
                        <select class="form-select form-select-sm" onchange="updateAccessLevel(${index}, this.value)">
                            <option value="User" ${request.accessLevel === 'User' ? 'selected' : ''}>User</option>
                            <option value="Administrator" ${request.accessLevel === 'Administrator' ? 'selected' : ''}>Administrator</option>
                            <option value="Guest" ${request.accessLevel === 'Guest' ? 'selected' : ''}>Guest</option>
                        </select>
                    </td>
                    <td>
                        <span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span>
                    </td>
                    <td>
                        <button class="btn btn-success btn-sm" onclick="approveRequest(${index})">Approve</button>
                        <button class="btn btn-danger btn-sm" onclick="rejectRequest(${index})">Reject</button>
                        <button class="btn btn-warning btn-sm" onclick="deleteRequest(${index})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusBadgeClass(status) {
            switch (status) {
                case 'Pending':
                    return 'bg-warning text-dark';
                case 'Granted':
                    return 'bg-success';
                case 'Rejected':
                    return 'bg-danger';
                default:
                    return 'bg-secondary';
            }
        }

        function updateAccessLevel(index, level) {
            accessRequests[index].accessLevel = level;
            localStorage.setItem('accessRequests', JSON.stringify(accessRequests));
        }

        function approveRequest(index) {
            accessRequests[index].status = 'Granted';
            localStorage.setItem('accessRequests', JSON.stringify(accessRequests));
            loadRequests();
        }

        function rejectRequest(index) {
            accessRequests[index].status = 'Rejected';
            localStorage.setItem('accessRequests', JSON.stringify(accessRequests));
            loadRequests();
        }

        function deleteRequest(index) {
            accessRequests.splice(index, 1);
            localStorage.setItem('accessRequests', JSON.stringify(accessRequests));
            loadRequests();
        }

        function filterRequests() {
            const searchTerm = searchInput.value.toLowerCase();
            const filteredRequests = accessRequests.filter(request =>
                (request.user && request.user.toLowerCase().includes(searchTerm)) ||
                (request.department && request.department.toLowerCase().includes(searchTerm)) ||
                request.service.toLowerCase().includes(searchTerm) ||
                request.status.toLowerCase().includes(searchTerm)
            );
            loadRequests(filteredRequests);
        }

        loadRequests();
    </script>
</body>

</html>
